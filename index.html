<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OFFICER REPORT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      color: #333;
    }

    .container {
      background: #fff;
      margin: 10px;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 15px;
      font-size: 20px;
      text-transform: uppercase;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 14px;
    }

    input[type="text"],
    input[type="datetime-local"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 3px;
      box-sizing: border-box;
    }

    input[type="datetime-local"] {
      appearance: none;
      -webkit-appearance: none;
    }

    textarea {
      resize: vertical;
    }

    .severity-select {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      flex-wrap: wrap;
      gap: 5px;
    }

    .severity-select label {
      flex: 1 1 30%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    .green { color: green; }
    .yellow { color: goldenrod; }
    .red { color: red; }

    button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 3px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.1s ease-in-out;
    }

    button:active {
      transform: scale(0.98);
    }

    .images-preview {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }

    .images-preview img {
      width: 75px;
      height: auto;
      border-radius: 3px;
    }

    .color-tag {
      font-weight: bold;
      font-size: 14px;
    }

    #otherIncidentContainer {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    #otherIncidentContainer.show {
      max-height: 100px;
    }

    #confirmationMessage,
    #maintenanceConfirmationMessage,
    #darConfirmationMessage,
    #vehicleConfirmationMessage {
      display: none;
      text-align: center;
      margin-top: 15px;
      color: green;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
  </style>
</head>
<body>

<!-- ============================= -->
<!-- REPORT TOGGLE BUTTONS -->
<!-- ============================= -->
<div style="margin: 10px;">
  <button onclick="toggleForm('officer')" style="margin-bottom:5px;">üëÆ‚Äç‚ôÇÔ∏è Officer Report</button>
  <button onclick="toggleForm('maintenance')" style="margin-bottom:5px;">üîß Maintenance Report</button>
  <button onclick="toggleForm('dar')" style="margin-bottom:5px;">üìã Daily Activity Report</button>
  <!-- ‚úÖ ADDED VEHICLE REPORT BUTTON -->
  <button onclick="toggleForm('vehicle')" style="margin-bottom:5px;">üöì Vehicle Report</button>
</div>
<!-- ============================= -->
<!-- OFFICER REPORT CONTAINER -->
<!-- ============================= -->
<div id="officerReportBox" style="display: none;">
  <div class="container">
    <h2>OFFICER REPORT</h2>
    <label for="officerName">Officer Name</label>
    <input type="text" id="officerName" placeholder="Enter officer's name">

    <label for="badgeNumber">Badge Number</label>
    <input type="text" id="badgeNumber" placeholder="Enter badge number">

    <label for="incidentDateTime">Incident Date & Time</label>
    <input type="datetime-local" id="incidentDateTime">

    <label for="location">Location</label>
    <input type="text" id="location" placeholder="Enter location or use GPS">
    <button type="button" onclick="getLocation('location')">Use My Location</button>

    <label>Incident Severity</label>
    <div class="severity-select">
      <label><input type="radio" name="severity" value="Low" onclick="updateSeverity('Low')"><span class="green">Low</span></label>
      <label><input type="radio" name="severity" value="Moderate" onclick="updateSeverity('Moderate')"><span class="yellow">Moderate</span></label>
      <label><input type="radio" name="severity" value="High" onclick="updateSeverity('High')"><span class="red">High</span></label>
    </div>
    <div id="severityDisplay" class="color-tag"></div>

    <label for="incidentType">Incident Type</label>
    <select id="incidentType" onchange="toggleOtherField(this)">
      <option value="Trespassing">Trespassing</option>
      <option value="Vandalism">Vandalism</option>
      <option value="Theft">Theft</option>
      <option value="Loitering">Loitering</option>
      <option value="Disturbance">Disturbance</option>
      <option value="Medical Emergency">Medical Emergency</option>
      <option value="Alarm Response">Alarm Response</option>
      <option value="Suspicious Person">Suspicious Person</option>
      <option value="Unauthorized Access">Unauthorized Access</option>
      <option value="Domestic Dispute">Domestic Dispute</option>
      <option value="Weapon Sighting">Weapon Sighting</option>
      <option value="Noise Complaint">Noise Complaint</option>
      <option value="Physical Altercation">Physical Altercation</option>
      <option value="Property Damage">Property Damage</option>
      <option value="Fire or Smoke">Fire or Smoke</option>
      <option value="Missing Person">Missing Person</option>
      <option value="Found Property">Found Property</option>
      <option value="Other">Other</option>
    </select>

    <div id="otherIncidentContainer">
      <label for="otherIncidentType">Specify Other Incident</label>
      <input type="text" id="otherIncidentType" placeholder="Describe other incident type">
    </div>

    <label for="incidentDetails">Incident Details</label>
    <textarea id="incidentDetails" rows="8" placeholder="Provide a full narrative of the incident..."></textarea>

    <label for="incidentStatus">Incident Status</label>
    <select id="incidentStatus">
      <option value="Resolved On Site">Resolved On Site</option>
      <option value="Escalated to Supervisor">Escalated to Supervisor</option>
      <option value="Ongoing / Requires Follow-up">Ongoing / Requires Follow-up</option>
    </select>

    <label for="photoUpload">Upload Photos (Max 4)</label>
    <input type="file" id="photoUpload" accept="image/*" multiple onchange="accumulatePreviewImages(this)">
    <div class="images-preview" id="previewContainer"></div>

    <button type="button" onclick="generatePDF()">Generate Report</button>
    <div id="confirmationMessage">Successfully generated PDF.</div>
  </div>
</div>

<!-- ============================= -->
<!-- MAINTENANCE REPORT CONTAINER -->
<!-- ============================= -->
<div id="maintenanceReportBox" style="display: none;">
  <div class="container">
    <h2>MAINTENANCE REPORT</h2>

    <label for="maintenanceIssue">Issue Description</label>
    <textarea id="maintenanceIssue" rows="6" placeholder="Describe the maintenance issue..."></textarea>

    <label for="maintenanceLocation">Location</label>
    <input type="text" id="maintenanceLocation" placeholder="Enter location or use GPS">
    <button type="button" onclick="getLocation('maintenanceLocation')">Use My Location</button>

    <label for="maintenanceStatus">Status</label>
    <select id="maintenanceStatus">
      <option>Reported</option>
      <option>In Progress</option>
      <option>Completed</option>
    </select>

    <label for="maintenanceUpload">Upload Photos (Max 4)</label>
    <input type="file" id="maintenanceUpload" accept="image/*" multiple onchange="accumulateMaintenanceImages(this)">
    <div class="images-preview" id="maintenancePreview"></div>

    <button type="button" onclick="generateMaintenancePDF()">Generate Maintenance Report</button>
    <div id="maintenanceConfirmationMessage">Successfully generated PDF.</div>
  </div>
</div>

<!-- ============================= -->
<!-- DAILY ACTIVITY REPORT CONTAINER -->
<!-- ============================= -->
<div id="dailyActivityReportBox" style="display: none;">
  <div class="container">
    <h2>DAILY ACTIVITY REPORT</h2>

    <div id="darEntryContainer"></div>
    <button type="button" onclick="addDAREntry()">‚ûï Add Entry</button>
    <button type="button" onclick="generateDARPdf()">Generate Daily Activity PDF</button>
    <div id="darConfirmationMessage">Successfully generated PDF.</div>
  </div>
</div>
<!-- ============================= -->
<!-- VEHICLE REPORT CONTAINER -->
<!-- ============================= -->
<div id="vehicleReportBox" style="display: none;">
  <div class="container">
    <h2>VEHICLE REPORT</h2>

    <!-- === OFFICER & VEHICLE INFO === -->
    <label for="vehicleOfficer">Officer Name</label>
    <input type="text" id="vehicleOfficer" placeholder="Enter officer's name">

    <label for="vehiclePlate">License Plate Number</label>
    <input type="text" id="vehiclePlate" placeholder="Enter or scan plate">
    <input type="file" id="vehiclePlateImage" accept="image/*">
    <button type="button" onclick="scanTextFromImage('vehiclePlateImage','vehiclePlate')">üîç Scan Plate</button>

    <label for="vehicleVIN">Vehicle VIN</label>
    <input type="text" id="vehicleVIN" placeholder="Enter or scan VIN">
    <input type="file" id="vehicleVINImage" accept="image/*">
    <button type="button" onclick="scanTextFromImage('vehicleVINImage','vehicleVIN')">üîç Scan VIN</button>

    <label for="vehicleMake">Vehicle Make</label>
    <input type="text" id="vehicleMake" placeholder="e.g., Ford">

    <label for="vehicleModel">Vehicle Model</label>
    <input type="text" id="vehicleModel" placeholder="e.g., Explorer">

    <label for="vehicleColor">Vehicle Color</label>
    <input type="text" id="vehicleColor" placeholder="e.g., Black">

    <label for="vehicleType">Vehicle Type</label>
    <select id="vehicleType">
      <option value="Sedan">Sedan</option>
      <option value="SUV">SUV</option>
      <option value="Truck">Truck</option>
      <option value="Van">Van</option>
      <option value="Motorcycle">Motorcycle</option>
      <option value="Other">Other</option>
    </select>
        <!-- === DRIVER INFORMATION === -->
    <label for="driverName">Driver Name</label>
    <input type="text" id="driverName" placeholder="Enter driver's full name">

    <label for="driverLicense">Driver License Number</label>
    <input type="text" id="driverLicense" placeholder="e.g., AZ1234567">

    <label for="driverContact">Driver Contact Info</label>
    <input type="text" id="driverContact" placeholder="Phone or email">

    <label for="driverAffiliation">Affiliation</label>
    <select id="driverAffiliation">
      <option value="Resident">Resident</option>
      <option value="Contractor">Contractor</option>
      <option value="Visitor">Visitor</option>
      <option value="Unknown">Unknown</option>
    </select>

    <!-- === PERMIT & ALERT TAGGING === -->
    <label for="permitNumber">Permit Number</label>
    <input type="text" id="permitNumber">

    <label for="permitExpiry">Permit Expiry Date</label>
    <input type="date" id="permitExpiry">

    <label for="vehicleAlert">Flag Vehicle</label>
    <select id="vehicleAlert">
      <option value="No Flag">No Flag</option>
      <option value="BOLO">BOLO</option>
      <option value="Suspicious">Suspicious</option>
      <option value="Previous Incident">Previous Incident</option>
    </select>

    <!-- === ENTRY / EXIT TIMES === -->
    <label for="entryTime">Entry Time</label>
    <input type="datetime-local" id="entryTime">

    <label for="exitTime">Exit Time</label>
    <input type="datetime-local" id="exitTime">
        <!-- === LOCATION W/ GPS === -->
    <label for="vehicleLocation">Location</label>
    <input type="text" id="vehicleLocation" placeholder="Enter or use GPS">
    <button type="button" onclick="getLocation('vehicleLocation')">Use My Location</button>

    <!-- === VEHICLE INSPECTION CHECKLIST === -->
    <label>Vehicle Inspection</label>
    <div class="severity-select" style="flex-wrap: wrap;">
      <label><input type="checkbox" id="checkPlate"> Plate Matches</label>
      <label><input type="checkbox" id="checkTags"> Tags Valid</label>
      <label><input type="checkbox" id="checkVIN"> VIN Verified</label>
      <label><input type="checkbox" id="checkDamage"> No Damage</label>
      <label><input type="checkbox" id="checkWindows"> Windows OK</label>
      <label><input type="checkbox" id="checkContraband"> No Contraband</label>
    </div>

    <!-- === NOTES / OBSERVATIONS === -->
    <label for="vehicleNote">Notes / Observations</label>
    <textarea id="vehicleNote" rows="6" placeholder="Any observations, comments, or concerns..."></textarea>
        <!-- === SIGNATURES === -->
    <label for="officerSignature">Officer Signature (type name)</label>
    <input type="text" id="officerSignature" placeholder="Officer full name">

    <label for="driverSignature">Driver Signature (type name)</label>
    <input type="text" id="driverSignature" placeholder="Driver full name (if available)">

    <!-- === PHOTO UPLOAD === -->
    <label for="vehiclePhotoUpload">Upload Vehicle Photos (Max 4)</label>
    <input type="file" id="vehiclePhotoUpload" accept="image/*" multiple onchange="accumulateVehiclePhotos(this)">
    <div class="images-preview" id="vehiclePreview"></div>

    <!-- === PDF GENERATOR === -->
    <button type="button" onclick="generateVehiclePDF()">Generate Vehicle Report</button>
    <div id="vehicleConfirmationMessage">Successfully generated PDF.</div>
  </div>
</div>
// =============================
// FORM TOGGLE HANDLER (UPDATED TO INCLUDE VEHICLE REPORT)
// =============================
function toggleForm(type) {
  const officer = document.getElementById("officerReportBox");
  const maintenance = document.getElementById("maintenanceReportBox");
  const dar = document.getElementById("dailyActivityReportBox");
  const vehicle = document.getElementById("vehicleReportBox");

  officer.style.display = "none";
  maintenance.style.display = "none";
  dar.style.display = "none";
  vehicle.style.display = "none";

  if (type === "officer") {
    officer.style.display = "block";
  } else if (type === "maintenance") {
    maintenance.style.display = "block";
  } else if (type === "dar") {
    dar.style.display = "block";
  } else if (type === "vehicle") {
    vehicle.style.display = "block";
  }
}
// =============================
// VEHICLE REPORT ‚Äì IMAGE HANDLING (Max 4)
// =============================
const vehiclePhotoFiles = [];

function accumulateVehiclePhotos(input) {
  const container = document.getElementById('vehiclePreview');
  const newFiles = Array.from(input.files);
  for (let i = 0; i < newFiles.length && vehiclePhotoFiles.length < 4; i++) {
    vehiclePhotoFiles.push(newFiles[i]);
    const reader = new FileReader();
    reader.onload = e => {
      const img = document.createElement('img');
      img.src = e.target.result;
      container.appendChild(img);
    };
    reader.readAsDataURL(newFiles[i]);
  }
  input.value = '';
}
// =============================
// OCR SCANNER ‚Äì TESSERACT.JS
// =============================
async function scanTextFromImage(imageInputId, outputInputId) {
  const input = document.getElementById(imageInputId);
  if (!input.files.length) return alert("Please upload an image first.");
  
  const file = input.files[0];
  const reader = new FileReader();

  reader.onload = async function(e) {
    const { createWorker } = Tesseract;
    const worker = await createWorker({
      logger: m => console.log(m) // Optional: remove or comment out to silence logs
    });

    await worker.loadLanguage('eng');
    await worker.initialize('eng');
    const { data: { text } } = await worker.recognize(e.target.result);
    await worker.terminate();

    const cleaned = text.replace(/[^a-zA-Z0-9]/g, '').trim().toUpperCase();
    document.getElementById(outputInputId).value = cleaned || "SCAN FAILED";
  };

  reader.readAsDataURL(file);
}
// =============================
// VEHICLE REPORT ‚Äì PDF GENERATOR
// =============================
async function generateVehiclePDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y = 10;

  pdf.setFont("helvetica", "bold");
  pdf.setFillColor(40, 40, 40);
  pdf.setTextColor(255, 255, 255);
  pdf.rect(10, y, 190, 10, "F");
  pdf.setFontSize(16);
  pdf.text("VEHICLE REPORT", 105, y + 7, { align: "center" });

  y += 20;

  const fields = [
    ["Officer", document.getElementById("vehicleOfficer").value],
    ["Plate", document.getElementById("vehiclePlate").value],
    ["VIN", document.getElementById("vehicleVIN").value],
    ["Make", document.getElementById("vehicleMake").value],
    ["Model", document.getElementById("vehicleModel").value],
    ["Color", document.getElementById("vehicleColor").value],
    ["Type", document.getElementById("vehicleType").value],
    ["Driver Name", document.getElementById("driverName").value],
    ["License #", document.getElementById("driverLicense").value],
    ["Contact", document.getElementById("driverContact").value],
    ["Affiliation", document.getElementById("driverAffiliation").value],
    ["Permit #", document.getElementById("permitNumber").value],
    ["Permit Expiry", document.getElementById("permitExpiry").value],
    ["Flag", document.getElementById("vehicleAlert").value],
    ["Entry Time", document.getElementById("entryTime").value],
    ["Exit Time", document.getElementById("exitTime").value],
    ["Location", document.getElementById("vehicleLocation").value]
  ];

  pdf.setFontSize(11);
  pdf.setTextColor(0);
  for (let i = 0; i < fields.length; i += 2) {
    pdf.setFont("helvetica", "bold");
    pdf.text(`${fields[i][0]}:`, 10, y);
    pdf.text(`${fields[i + 1][0]}:`, 105, y);
    pdf.setFont("helvetica", "normal");
    pdf.text(fields[i][1] || "N/A", 60, y);
    pdf.text(fields[i + 1][1] || "N/A", 145, y);
    y += 8;
  }

  // Checklist
  pdf.setFont("helvetica", "bold");
  pdf.setFillColor(220, 220, 220);
  pdf.rect(10, y, 190, 8, "F");
  pdf.text("Vehicle Inspection Checklist", 12, y + 6);
  y += 14;

  const checks = [
    ["Plate Matches", "checkPlate"],
    ["Tags Valid", "checkTags"],
    ["VIN Verified", "checkVIN"],
    ["No Damage", "checkDamage"],
    ["Windows OK", "checkWindows"],
    ["No Contraband", "checkContraband"]
  ];

  pdf.setFont("helvetica", "normal");
  for (let i = 0; i < checks.length; i++) {
    const label = checks[i][0];
    const id = checks[i][1];
    const val = document.getElementById(id).checked ? "‚úÖ Yes" : "‚ùå No";
    pdf.text(`${label}: ${val}`, 10, y);
    y += 6;
  }

  // Notes
  y += 4;
  pdf.setFont("helvetica", "bold");
  pdf.setFillColor(220, 220, 220);
  pdf.rect(10, y, 190, 8, "F");
  pdf.text("Officer Notes", 12, y + 6);
  y += 14;

  pdf.setFont("helvetica", "normal");
  const notes = document.getElementById("vehicleNote").value || "N/A";
  const split = pdf.splitTextToSize(notes, 185);
  pdf.text(split, 10, y);
  y += split.length * 6 + 5;

  // Images
  for (let i = 0; i < Math.min(4, vehiclePhotoFiles.length); i++) {
    const file = vehiclePhotoFiles[i];
    const reader = new FileReader();
    await new Promise(resolve => {
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          if (y > 240) {
            pdf.addPage();
            y = 10;
          }
          pdf.addImage(img, 'JPEG', 10, y, 60, 45);
          y += 50;
          resolve();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  // Signatures
  y += 10;
  pdf.setFont("helvetica", "bold");
  pdf.setFillColor(220, 220, 220);
  pdf.rect(10, y, 190, 8, "F");
  pdf.text("Signatures", 12, y + 6);
  y += 14;
  pdf.setFont("helvetica", "normal");
  pdf.text(`Officer Signature: ${document.getElementById("officerSignature").value || "N/A"}`, 10, y); y += 6;
  pdf.text(`Driver Signature: ${document.getElementById("driverSignature").value || "N/A"}`, 10, y); y += 6;

  // Timestamp
  const timestamp = new Date().toLocaleString();
  pdf.setFontSize(8);
  pdf.setTextColor(100);
  pdf.text(`Generated on ${timestamp}`, 200, 290, { align: "right" });

  pdf.save("vehicle_report.pdf");

  const msg = document.getElementById('vehicleConfirmationMessage');
  msg.style.display = "block";
  msg.style.opacity = 1;
  setTimeout(() => {
    msg.style.opacity = 0;
    setTimeout(() => msg.style.display = "none", 500);
  }, 2500);
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
</body>
</html>