<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Push-to-Talk Test</title>
  <style>
    #pttButton {
      padding: 20px;
      font-size: 20px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 10px;
    }
    #pttButton.talking {
      background-color: green;
    }
  </style>
</head>
<body>
  <h1>Push-to-Talk (Prototype 1)</h1>

  <input id="username" type="text" placeholder="Enter your name" />
  <br><br>

  <button id="pttButton" ontouchstart="startTalking()" ontouchend="stopTalking()" onmousedown="startTalking()" onmouseup="stopTalking()">
    Push-to-Talk
  </button>

  <h2 id="status">Idle</h2>

  <script>
    let mediaRecorder;
    let stream;

    async function startTalking() {
      const name = document.getElementById('username').value.trim();
      if (!name) {
        alert('Please enter your name first.');
        return;
      }

      const button = document.getElementById('pttButton');
      const status = document.getElementById('status');

      try {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        button.classList.add('talking');
        status.innerText = `${name} is Talking...`;

        // For now, just open mic â€” no streaming yet
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaStreamSource(stream);
        source.connect(audioContext.destination); // Play your own voice for test

      } catch (err) {
        alert('Microphone access denied or unavailable.');
        console.error(err);
      }
    }

    function stopTalking() {
      const button = document.getElementById('pttButton');
      const status = document.getElementById('status');

      button.classList.remove('talking');
      status.innerText = `Idle`;

      if (stream) {
        let tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
      }
    }
  </script>
</body>
</html>